---
title: "KubeCon 2023 上海：OpenTelemetry 采样分享"
date: 2023-09-26T12:35:49+08:00
author: jiekun.dev@gmail.com
category: Observability
comments: true
---

## 0. 前言
因为一直有关注 Kubernetes 相关的内容，在 4 月 19 日 KubeCon + CloudNativeCon Europe 2023 举行期间，就已经知道时隔 3 年，CNCF 的旗舰会议要回到国内线下举行了。恰逢最近半年学习重心转向 Observability，往往在起步阶段接触的新东西变多，就容易萌生一点“自以为是”和“向别人分享”的想法，于是提交了 CFP 碰碰运气。

7 月末得知 Proposal 被接受了，可以看得出来主办方是眷顾新人的。当时心情颇为复杂，一边是可以在更大的舞台跟众多开发者交流，一边是工作还没着落，很多准备材料都还处于原始的阶段。后续又熬过了2个月，熬出了只言片语，也不知道听众的接受度会有多高，所以到正式分享前都非常紧张。整个过程中有很多人给过我建议，特别需要感谢 Juraci Paixão Kröhling、Reese Lee、陆家靖老师和赵梓旗老师的 Review，带着这些的指导意见我才得以进一步完善分享和输出观点。

## 1. 可观测性之旅
云原生时代，微服务的使用越来越广泛，大家都将原有的单体服务拆分成小块。趣丸，一家主打兴趣社交和电子竞技的科技公司，亦是如此。在企业内，大部分的项目都运行在 Kubernetes 之上，搭配 Istio。对应用服务的观察，数据来源于服务内 SDK 上报、Istio 以及其他部署在节点上的 Agent。聚焦在分布式追踪这方面，我们每日产生超过百亿的 Span。通用的基础设施能提供非常多的监控指标，但仍有一些不起眼的角落缺乏足够的关注。为了覆盖这些场景，我们探索了 eBPF 的使用，尝试为各种没有 Istio 支持，或者出于各种原因缺乏埋点的应用提供请求级别的可观测性支持。

在所有这些探索的过程中，越来越多的数据被送入处理流程。例如，在一个规模中等的集群使用 eBPF 采集数据时，每天有 40 TiB 的 Trace 数据产生。使用这些数据是有成本的，我们必须考虑它是否值得：
- 有多少的 Trace 数据对问题排查有帮助？
- 怎样做才可以减少这些数据的产生呢？

OpenTelemetry 生态中提供了一些简单的手段应对上面的问题。

## 2. The OpenTelemetry Ways
在详细了解解决方案之前，我们花几分钟再介绍一下分布式追踪。

## 3. 资源使用

## 4. 更有趣的想法？

## 5. 展望

## 6. 问与答